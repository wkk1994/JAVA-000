# 学习笔记

## 1、（必做）针对课上讲解的内容，自己动手设计一个高并发的秒杀系统，讲架构图， 设计文档等，提交到github。

### 1.关键需求

实现商品秒杀功能，对少量的商品进行秒杀，吸引大量用户关注与参与，给平台带来可观的流量，以及周边商品的销量提升。

### 2.需求分析

#### 2.1 功能性需求

##### 2.1.1 商品秒杀配置

**需求说明**

随着业务的发展，后续会有很多秒杀业务，不同的秒杀业务，秒杀规则不同。要求系统要支持灵活的秒杀配置，比如用户过滤配置、单个用户商品秒杀数量限制、商品折扣、商品库存等配置。

**分析解决**

&nbsp;&nbsp;&nbsp;&nbsp;秒杀配置功能一般并发量不大，与具体的秒杀相关小，可以单独作为一个应用部署。对于通用的秒杀配置，比如用户过滤、用户秒杀数量限制、商品折扣方式、商品库存等可以作为配置的内置功能提供，秒杀配置时可以直接选择配置；秒杀的配置规则支持扩展，使用插件的方式实现自定义规则的定义。

&nbsp;&nbsp;&nbsp;&nbsp;需要注意的是，秒杀中对用户进行规则校验是否符合秒杀配置的规则需要消耗一定的时间，会一定程度降低秒杀系统的性能。可以对配置条件提前进行缓存预热，解决配置条件查询DB的耗时。在对于某些限定条件下，比如只允许预约的用户才能抢购，可以在秒杀开始前，提前将有秒杀资格的用户id存储到缓存系统中，减少秒杀配置规则的校验。

##### 2.1.2 超时订单返场

**需求说明**

&nbsp;&nbsp;&nbsp;&nbsp;对超时订单支持商品返场功能，抢购用户在商品详情页面可以看到提示，提示用户当前有部分用户超时未支付，仍有机会抢购。

**分析解决**

&nbsp;&nbsp;&nbsp;&nbsp;
##### 2.1.3 超卖或销售不足

保证超卖或销售不足的出现率低于xx%，对于特定的商品（比如库存明确、价值巨大的商品）不允许超卖。

##### 2.1.4 防秒杀器

防止秒杀器对商品抢购成功，造成用户抢购不公平的现象。

##### 2.1.5 兜底策略

在出现始料未及的并发时，要求系统有兜底策略，能以较低的限度完成秒杀活动。

##### 2.1.6 秒杀的监控

在商品秒杀完成后，对商品秒杀情况进行统计，对出现超卖或者销售不足的商品，及时通知对应负责人，该返场的返场，该退单的退单。

#### 2.2 非功能性需求

##### 2.2.1 伸缩性

要求系统在大量秒杀活动或秒杀活动减少时，支持快速的伸缩性，以此减少资源占用。

##### 2.2.2 可靠性

系统的故障处理，最大不能超过xx秒，连续正常运行不得低于xxx小时。

##### 2.2.3 性能

系统99%响应时间不得低于xxx毫秒，最大响应时间不得超过xxx秒。

### 技术选型和实现策略

* redis分片集群
* 系统监控，监控超卖或销售不足
* 对超卖的容忍度
* 对订单超时未支付，货物需要返场。
* 如果使用redis分片集群，类似内存分片的方式保存库存。最后出现访问不均匀会出现销售不足怎么办？
* 服务的设计容量和能力
* 对出现请求量过大的兜底策略
* 如何压测服务
* 对于秒杀商品分级处理，预测请求量，热门商品需要更多的资源，非热门的商品进行秒杀，量较小。通过预约才能抢购，这样可以预测用户量。或者通过商品详情页的UV预测用户量。
* 秒杀平台的配置。
* 避免同一时间大量的商品进行秒杀活动。
* 防秒杀器